

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Runtime &mdash; FleCSI invalid documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://flecsi.orgsrc/tutorial/runtime.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Control Model" href="control.html" />
    <link rel="prev" title="Tutorial" href="../tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/flecsi.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                Version: invalid
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">Build &amp; Install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#building-the-examples">Building the Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#using-the-docker-container">Using the Docker Container</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html#tutorial-examples">Tutorial Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Runtime</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-1-minimal">Example 1: Minimal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-2-program-options">Example 2: Program Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-3-flog-flecsi-logging-utility">Example 3: FLOG (FleCSI Logging Utility)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="control.html">Control Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="standalone.html">Standalone</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="http://laristra.github.io/flecsi/doxygen">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FleCSI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorial.html">Tutorial</a> &raquo;</li>
        
      <li>Runtime</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/src/tutorial/runtime.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="runtime">
<h1>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h1>
<p>Using FleCSI requires proper initialization and configuration of the
FleCSI runtime. These examples illustrate some of the basic steps and
options that are available.</p>
<hr class="docutils" />
<div class="section" id="example-1-minimal">
<h2>Example 1: Minimal<a class="headerlink" href="#example-1-minimal" title="Permalink to this headline">¶</a></h2>
<p>The core FleCSI runtime has three control points: <em>initialize</em>, <em>start</em>, and
<em>finalize</em>. These must be invoked by the user’s application code in that
order.</p>
<div class="sidebar">
<p class="sidebar-title">Top-level Action</p>
<p>The top-level action is a C++ function created by the user to tell
FleCSI what it should do when the <em>start</em> control point is invoked.</p>
</div>
<ul class="simple">
<li><p><strong>initialize</strong> <br />
This control point spins up the FleCSI runtime, and (optionally) any
other runtimes on which FleCSI depends.</p></li>
<li><p><strong>start</strong> <br />
This control point begins the actual runtime execution that forms the
bulk of any simulation that is performed using FleCSI. The user must
pass a top-level action that FleCSI will execute.</p></li>
<li><p><strong>finalize</strong> <br />
This control point shuts down the FleCSI runtime, and any other
runtimes that FleCSI itself initialized.</p></li>
</ul>
<p>This example demonstrates a minimal use of FleCSI that just executes an
action to print out <em>Hello World</em>. Code for this example can be found in
<em>tutorial/1-runtime/1-minimal.cc</em>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    @@@@@@@@  @@           @@@@@@   @@@@@@@@ @@</span>
<span class="cm">   /@@/////  /@@          @@////@@ @@////// /@@</span>
<span class="cm">   /@@       /@@  @@@@@  @@    // /@@       /@@</span>
<span class="cm">   /@@@@@@@  /@@ @@///@@/@@       /@@@@@@@@@/@@</span>
<span class="cm">   /@@////   /@@/@@@@@@@/@@       ////////@@/@@</span>
<span class="cm">   /@@       /@@/@@//// //@@    @@       /@@/@@</span>
<span class="cm">   /@@       @@@//@@@@@@ //@@@@@@  @@@@@@@@ /@@</span>
<span class="cm">   //       ///  //////   //////  ////////  //</span>

<span class="cm">   Copyright (c) 2016, Triad National Security, LLC</span>
<span class="cm">   All rights reserved.</span>
<span class="cm">                                                                              */</span>

<span class="cp">#include</span> <span class="cpf">&lt;flecsi/execution.hh&gt;</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm">  The top-level action can be any C/C++ function that takes (int, char**) and</span>
<span class="cm">  returns an int.</span>

<span class="cm">  In this simple example, we only print a message to indicate that the</span>
<span class="cm">  top-level action was actually executed by FleCSI. However, in a real</span>
<span class="cm">  application, the top-level action would execute FleCSI tasks and other</span>
<span class="cm">  functions to implement the simulation.</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">top_level_action</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello World&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// top_level_action</span>

<span class="cm">/*</span>
<span class="cm">  The main function must invoke initialize, start, and finalize on the FleCSI</span>
<span class="cm">  runtime. Otherwise, the implementation of main is left to the user.</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">auto</span> <span class="n">status</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">initialize</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">    The status returned by FleCSI&#39;s initialize method should be inspected to</span>
<span class="cm">    see if the end-user specified --help on the command line. FleCSI has</span>
<span class="cm">    built-in command-line support using Boost Program Options. This is</span>
<span class="cm">    documented in the next example.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">run</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">status</span> <span class="o">==</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">run</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">help</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">status</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// if</span>

  <span class="cm">/*</span>
<span class="cm">    The top-level action is passed to the start function to tell FleCSI what</span>
<span class="cm">    it should execute.</span>
<span class="cm">   */</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">start</span><span class="p">(</span><span class="n">top_level_action</span><span class="p">);</span>

  <span class="n">flecsi</span><span class="o">::</span><span class="n">finalize</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// main</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The top-level action can be any C/C++ function that takes no
arguments and returns an int.  In this simple example, we only print
a message to indicate that the top-level action was actually
executed by FleCSI. However, in a real application, the top-level
action would execute FleCSI tasks and other functions to implement
the simulation.</p></li>
<li><p>The main function must invoke initialize, start, and finalize on the
FleCSI runtime. Otherwise, the implementation of main is left to the
user.</p></li>
<li><p>The status returned by FleCSI’s initialize method should be
inspected to see if the end-user specified –help on the command
line. FleCSI has built-in command-line support using Boost Program
Options. This is documented in the next example.</p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="example-2-program-options">
<h2>Example 2: Program Options<a class="headerlink" href="#example-2-program-options" title="Permalink to this headline">¶</a></h2>
<p>FleCSI supports a program options capability based on <a class="reference external" href="https://www.boost.org/doc/libs/1_63_0/doc/html/program_options.html">Boost Program
Options</a> to simplify the creation and management of user-defined
command-line options. The basic syntax for adding and accessing program
options is semantically similar to the Boost interface (You can find
documentation using the above link.) However, there are some notable
differences:</p>
<ul class="simple">
<li><p>FleCSI internally manages the boost::program_options::value variables
for you, using boost::optional.</p></li>
<li><p>Positional options are the mechanism that should be used for
<em>required</em> options.</p></li>
<li><p>Default, implicit, zero, and multi value attributes are specified in
the flecsi::program_option constructor as an std::initializer_list.</p></li>
</ul>
<p>This section of the tutorial provides examples of how to use FleCSI’s
program option capability.</p>
<div class="section" id="example-program">
<h3>Example Program<a class="headerlink" href="#example-program" title="Permalink to this headline">¶</a></h3>
<p>In this example, imagine that you have a program that takes information
about a taxi service (The options are silly and synthetic. However they
demonstrate the basic usage of the flecsi::program_option type.) The
command-line options and arguments for the program allow specification
of the following: trim level, transmission, child seat, purpose
(personal or business), light speed, and a passenger list. The first two
options will be in a <em>Car Options</em> section, while the purpose will be
under the <em>Ride Options</em> section. The passenger list is a positional
argument to the program. The help output for the entire program looks
like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Usage: program_options &lt;passenger-list&gt;</span>

<span class="go">Positional Options:</span>
<span class="go">  passenger-list The list of passengers for this trip [.txt].</span>

<span class="go">Basic Options:</span>
<span class="go">  -h [ --help ]                         Print this message and exit.</span>

<span class="go">Car Options:</span>
<span class="go">  -l [ --level ] arg (= 1)              Specify the trim level [1-10].</span>
<span class="go">  -t [ --transmission ] arg (= manual)  Specify the transmission type</span>
<span class="go">                                        [&quot;automatic&quot;, &quot;manual&quot;].</span>
<span class="go">  -c [ --child-seat ] [=arg(= 1)] (= 0) Request a child seat.</span>

<span class="go">Ride Options:</span>
<span class="go">  -p [ --purpose ] arg (= 1)            Specify the purpose of the trip</span>
<span class="go">                                        (personal=0, business=1).</span>
<span class="go">  --lightspeed                          Travel at the speed of light.</span>

<span class="go">FleCSI Options:</span>
<span class="go">  --flog-tags arg (=all)         Enable the specified output tags, e.g.,</span>
<span class="go">                                 --flog-tags=tag1,tag2.</span>
<span class="go">  --flog-verbose [=arg(=1)] (=0) Enable verbose output. Passing &#39;-1&#39; will strip</span>
<span class="go">                                 any additional decorations added by flog and</span>
<span class="go">                                 will only output the user&#39;s message.</span>
<span class="go">  --flog-process arg (=-1)       Restrict output to the specified process id.</span>

<span class="go">Available FLOG Tags (FleCSI Logging Utility):</span>
<span class="go">  execution</span>
<span class="go">  task_wrapper</span>
<span class="go">  legion_mapper</span>
<span class="go">  unbind_accessors</span>
<span class="go">  topologies</span>
<span class="go">  reduction_wrapper</span>
<span class="go">  context</span>
<span class="go">  registration</span>
<span class="go">  bind_accessors</span>
<span class="go">  task_prologue</span>
</pre></div>
</div>
<p>This shows the program usage, the basic options, e.g., <code class="docutils literal notranslate"><span class="pre">--help</span></code>, the
command-line and positional options for the example, and some auxiliary
options for controlling the FleCSI logging utility <em>FLOG</em> (described in the
next section of this tutorial). The FLOG options will only appear if
<em>ENABLE_FLOG=ON</em> was set in your FleCSI build.</p>
</div>
<div class="section" id="declaring-options">
<h3>Declaring Options<a class="headerlink" href="#declaring-options" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>FleCSI program options must be declared at namespace scope, i.e.,
outside of any function, class, or enum class. This is not a problem! It
is often convenient to declare them in a header file (in which case,
they must also be declared <em>inline</em>), or directly before the <em>main</em>
function.  We use the latter for this example simply for conciseness.</p>
</div>
<p>Let’s consider the first <em>Car Options</em> option: <code class="docutils literal notranslate"><span class="pre">--level</span></code>. To declare
this option, we use the following declaration:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Add an integer-valued command-line option with a default value of &#39;1&#39;. The</span>
<span class="cm">  option will have a long form --level, and a short form -l. The option will be</span>
<span class="cm">  added under the &quot;Car Options&quot; section.</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">trim</span><span class="p">(</span><span class="s">&quot;Car Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;level,l&quot;</span><span class="p">,</span>
  <span class="s">&quot;Specify the trim level [1-10].&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="mi">1</span><span class="p">}},</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>First, notice that the flecsi::program_option type is templated on the
underlying option type <em>int</em>. In general, this can be any valid C++
type.</p>
<p>This constructor to flecsi::program_option takes the following
parameters:</p>
<ul class="simple">
<li><p><em>section (“Car Options”)</em>: <br />
Identifies the section. Sections are generated automatically, simply
by referencing them in a program option.</p></li>
<li><p><em>flag (“level,l”)</em>: <br />
The long and short forms of the option. If the string contains a
comma, it is split into <em>long name,short name</em>. If there is no comma,
the string is used as the long name with no short name.</p></li>
<li><p><em>help (“Specify…”)</em> <br />
The help description that will be displayed when the usage message
is printed.</p></li>
<li><p><em>values ({{flecsi::option_default, …}})</em> <br />
This is a
std::initializer_list&lt;flecsi::program_option::initializer_value&lt;int&gt;&gt;.
The possible values are flecsi::option_default,
flecsi::option_implicit, flecsi::option_zero, and
flecsi::option_multi. The default value is used if the option is not
passed at invocation. The implicit value is used if the option is
passed without a value. If zero is specified, the option does not take
an argument, and an implicit value must be provided. If multi is
specified, the option takes multiple values.</p></li>
<li><p><em>check ([](flecsi::any const &amp;…)</em> <br />
An optional, user-defined predicate to validate the value passed by
the user.</p></li>
</ul>
<p>The next option <code class="docutils literal notranslate"><span class="pre">--transmission</span></code> is similar, but uses a std::string
value type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Add a string-valued command-line option with a default value of &quot;manual&quot;. The</span>
<span class="cm">  option will have a long form --transmission, and a short form -t. The option</span>
<span class="cm">  will be added under the &quot;Car Options&quot; section.</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">transmission</span><span class="p">(</span><span class="s">&quot;Car Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;transmission,t&quot;</span><span class="p">,</span>
  <span class="s">&quot;Specify the transmission type [</span><span class="se">\&quot;</span><span class="s">automatic</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">manual</span><span class="se">\&quot;</span><span class="s">].&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="s">&quot;manual&quot;</span><span class="p">}},</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&quot;manual&quot;</span> <span class="o">||</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&quot;automatic&quot;</span><span class="p">;</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>The only real difference is that (because the underlying type is
std::string) the default value is also a string.</p>
<p>The last option in the “Car Options” section <code class="docutils literal notranslate"><span class="pre">--child-seat</span></code>
demonstrates the use of flecsi::option_implicit:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Add an option that defines an implicit value. If the program is invoked with</span>
<span class="cm">  --child-seat, the value will be true. If it is invoked without --child-seat,</span>
<span class="cm">  the value will be false. This style of option should not be used with</span>
<span class="cm">  positional arguments because Boost appears to have a bug when such options</span>
<span class="cm">  are invoked directly before a positional option (gets confused about</span>
<span class="cm">  separation). We break that convention here for the sake of completeness.</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">child_seat</span><span class="p">(</span><span class="s">&quot;Car Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;child-seat,c&quot;</span><span class="p">,</span>
  <span class="s">&quot;Request a child seat.&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="nb">false</span><span class="p">},</span> <span class="p">{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_implicit</span><span class="p">,</span> <span class="nb">true</span><span class="p">}});</span>
</pre></div>
</div>
<p>Providing an implicit value, defines the behavior for the case that the
user invokes the program with the given flag, but does not assign a
value, e.g., <code class="docutils literal notranslate"><span class="pre">--child-seat</span></code> vs. <code class="docutils literal notranslate"><span class="pre">--child-seat=1</span></code>. The value is
<em>implied</em> by the flag itself.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This style of option should not be used with positional arguments
because Boost appears to have a bug when such options are invoked
directly before a positional option (gets confused about separation).
We break that convention here for the sake of completeness. If you
need an option that simply acts as a switch, i.e., it is either <em>on</em>
or <em>off</em>, consider using the <code class="docutils literal notranslate"><span class="pre">--lightspeed</span></code> style option below, as
this type of option is safe to use with positional options.</p>
</div>
<p>The first option in the <em>Ride Options</em> section <code class="docutils literal notranslate"><span class="pre">--purpose</span></code> takes an
integer value <em>0</em> or <em>1</em>. This option is declared with the following
code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Add a an option to a different section, i.e., &quot;Ride Options&quot;. The enumeration</span>
<span class="cm">  type is not enforced by the FleCSI runtime, and is mostly for convenience.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="nl">purpose_option</span> <span class="p">:</span> <span class="kt">size_t</span> <span class="p">{</span> <span class="n">personal</span><span class="p">,</span> <span class="n">business</span> <span class="p">};</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">purpose</span><span class="p">(</span><span class="s">&quot;Ride Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;purpose,p&quot;</span><span class="p">,</span>
  <span class="s">&quot;Specify the purpose of the trip (personal=0, business=1).&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="n">purpose_option</span><span class="o">::</span><span class="n">business</span><span class="p">}},</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="n">personal</span> <span class="o">||</span> <span class="n">value</span> <span class="o">==</span> <span class="n">business</span><span class="p">;</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>This option demonstrates how an enumeration can be used to define
possible values. Although FleCSI does not enforce correctness, the
enumeration can be used to check that the user-provided value is valid.</p>
<p>The next option in the <em>Ride Options</em> section <code class="docutils literal notranslate"><span class="pre">--lightspeed</span></code> defines
an implicit value and zero values (meaning that it takes no values). The
<code class="docutils literal notranslate"><span class="pre">--lightspeed</span></code> option acts as a switch, taking the implicit value if
the flag is passed.  This will be useful to demonstrate how we can check
whether or not an option was passed in the next section:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Add an option with no default. This will allow us to demonstrate testing an</span>
<span class="cm">  option with has_value().</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">lightspeed</span><span class="p">(</span><span class="s">&quot;Ride Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;lightspeed&quot;</span><span class="p">,</span>
  <span class="s">&quot;Travel at the speed of light.&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_implicit</span><span class="p">,</span> <span class="nb">true</span><span class="p">},</span> <span class="p">{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_zero</span><span class="p">}});</span>
</pre></div>
</div>
<p>The final option in this example is a positional option, i.e., it is an
argument to the program itself:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Add a positional option. This uses a different constructor from the previous</span>
<span class="cm">  option declarations. Positional options are a replacement for required</span>
<span class="cm">  options (in the normal boost::program_options interface).</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">passenger_list</span><span class="p">(</span><span class="s">&quot;passenger-list&quot;</span><span class="p">,</span>
  <span class="s">&quot;The list of passengers for this trip [.txt].&quot;</span><span class="p">,</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.txt&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">;</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>Positional options are required, i.e., the program will error and print
the usage message if a value is not passed.</p>
</div>
<div class="section" id="checking-using-options">
<h3>Checking &amp; Using Options<a class="headerlink" href="#checking-using-options" title="Permalink to this headline">¶</a></h3>
<p>FleCSI option variables are implemented using an <em>optional</em> C++ type.
The utility of this implementation is that <em>optional</em> already captures
the behavior that we want from an option, i.e., it either has a value,
or it does not. If the option has a value, the specific value depends on
whether or not the user explicitly passed the option on the command
line, and its default and implicit values.</p>
<p>Options that have a default value defined do not need to be tested:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    Add cost for trim level. This option does not have to be checked with</span>
<span class="cm">    has_value() because it is defaulted. It is also unnecessary to check the</span>
<span class="cm">    value because it was declared with a validator function.</span>
<span class="cm">   */</span>

  <span class="n">price</span> <span class="o">+=</span> <span class="n">trim</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    Add cost for automatic transmission.</span>
<span class="cm">   */</span>

  <span class="n">price</span> <span class="o">+=</span> <span class="n">transmission</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;automatic&quot;</span> <span class="o">?</span> <span class="mf">200.0</span> <span class="o">:</span> <span class="mf">0.0</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    Add cost for child seat.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">child_seat</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">price</span> <span class="o">+=</span> <span class="mf">50.0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Deduction for business.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">purpose</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">business</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">price</span> <span class="o">*=</span> <span class="mf">0.8</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Here, we simply need to access the value of the option using the
<em>value()</em> method.</p>
<p>For options with no default value, we can check whether or not the
option has a value using the <em>has_value()</em> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    Add cost for lightspeed. Since this option does not have a default, we need</span>
<span class="cm">    to check whether or not the flag was passed.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">lightspeed</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">price</span> <span class="o">+=</span> <span class="mf">1000000.0</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Our one positional option works like the defaulted options (because it
is required), and can be accessed using the <em>value()</em> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    Do something with the positional argument.</span>
<span class="cm">   */</span>

  <span class="k">auto</span> <span class="n">read_file</span> <span class="o">=</span> <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Read passengers...</span>
    <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kt">size_t</span> <span class="n">passengers</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">passenger_list</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>

  <span class="n">price</span> <span class="o">*=</span> <span class="n">passengers</span> <span class="o">*</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
</pre></div>
</div>
<p>Here is the full source for this tutorial example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    @@@@@@@@  @@           @@@@@@   @@@@@@@@ @@</span>
<span class="cm">   /@@/////  /@@          @@////@@ @@////// /@@</span>
<span class="cm">   /@@       /@@  @@@@@  @@    // /@@       /@@</span>
<span class="cm">   /@@@@@@@  /@@ @@///@@/@@       /@@@@@@@@@/@@</span>
<span class="cm">   /@@////   /@@/@@@@@@@/@@       ////////@@/@@</span>
<span class="cm">   /@@       /@@/@@//// //@@    @@       /@@/@@</span>
<span class="cm">   /@@       @@@//@@@@@@ //@@@@@@  @@@@@@@@ /@@</span>
<span class="cm">   //       ///  //////   //////  ////////  //</span>

<span class="cm">   Copyright (c) 2016, Triad National Security, LLC</span>
<span class="cm">   All rights reserved.</span>
<span class="cm">                                                                              */</span>

<span class="cp">#include</span> <span class="cpf">&lt;flecsi/execution.hh&gt;</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm">  Add an integer-valued command-line option with a default value of &#39;1&#39;. The</span>
<span class="cm">  option will have a long form --level, and a short form -l. The option will be</span>
<span class="cm">  added under the &quot;Car Options&quot; section.</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">trim</span><span class="p">(</span><span class="s">&quot;Car Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;level,l&quot;</span><span class="p">,</span>
  <span class="s">&quot;Specify the trim level [1-10].&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="mi">1</span><span class="p">}},</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span>
  <span class="p">});</span>

<span class="cm">/*</span>
<span class="cm">  Add a string-valued command-line option with a default value of &quot;manual&quot;. The</span>
<span class="cm">  option will have a long form --transmission, and a short form -t. The option</span>
<span class="cm">  will be added under the &quot;Car Options&quot; section.</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">transmission</span><span class="p">(</span><span class="s">&quot;Car Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;transmission,t&quot;</span><span class="p">,</span>
  <span class="s">&quot;Specify the transmission type [</span><span class="se">\&quot;</span><span class="s">automatic</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">manual</span><span class="se">\&quot;</span><span class="s">].&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="s">&quot;manual&quot;</span><span class="p">}},</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&quot;manual&quot;</span> <span class="o">||</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&quot;automatic&quot;</span><span class="p">;</span>
  <span class="p">});</span>

<span class="cm">/*</span>
<span class="cm">  Add an option that defines an implicit value. If the program is invoked with</span>
<span class="cm">  --child-seat, the value will be true. If it is invoked without --child-seat,</span>
<span class="cm">  the value will be false. This style of option should not be used with</span>
<span class="cm">  positional arguments because Boost appears to have a bug when such options</span>
<span class="cm">  are invoked directly before a positional option (gets confused about</span>
<span class="cm">  separation). We break that convention here for the sake of completeness.</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">child_seat</span><span class="p">(</span><span class="s">&quot;Car Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;child-seat,c&quot;</span><span class="p">,</span>
  <span class="s">&quot;Request a child seat.&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="nb">false</span><span class="p">},</span> <span class="p">{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_implicit</span><span class="p">,</span> <span class="nb">true</span><span class="p">}});</span>

<span class="cm">/*</span>
<span class="cm">  Add a an option to a different section, i.e., &quot;Ride Options&quot;. The enumeration</span>
<span class="cm">  type is not enforced by the FleCSI runtime, and is mostly for convenience.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="nl">purpose_option</span> <span class="p">:</span> <span class="kt">size_t</span> <span class="p">{</span> <span class="n">personal</span><span class="p">,</span> <span class="n">business</span> <span class="p">};</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">purpose</span><span class="p">(</span><span class="s">&quot;Ride Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;purpose,p&quot;</span><span class="p">,</span>
  <span class="s">&quot;Specify the purpose of the trip (personal=0, business=1).&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_default</span><span class="p">,</span> <span class="n">purpose_option</span><span class="o">::</span><span class="n">business</span><span class="p">}},</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="n">personal</span> <span class="o">||</span> <span class="n">value</span> <span class="o">==</span> <span class="n">business</span><span class="p">;</span>
  <span class="p">});</span>

<span class="cm">/*</span>
<span class="cm">  Add an option with no default. This will allow us to demonstrate testing an</span>
<span class="cm">  option with has_value().</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">lightspeed</span><span class="p">(</span><span class="s">&quot;Ride Options&quot;</span><span class="p">,</span>
  <span class="s">&quot;lightspeed&quot;</span><span class="p">,</span>
  <span class="s">&quot;Travel at the speed of light.&quot;</span><span class="p">,</span>
  <span class="p">{{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_implicit</span><span class="p">,</span> <span class="nb">true</span><span class="p">},</span> <span class="p">{</span><span class="n">flecsi</span><span class="o">::</span><span class="n">option_zero</span><span class="p">}});</span>

<span class="cm">/*</span>
<span class="cm">  Add a positional option. This uses a different constructor from the previous</span>
<span class="cm">  option declarations. Positional options are a replacement for required</span>
<span class="cm">  options (in the normal boost::program_options interface).</span>
<span class="cm"> */</span>

<span class="n">flecsi</span><span class="o">::</span><span class="n">program_option</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">passenger_list</span><span class="p">(</span><span class="s">&quot;passenger-list&quot;</span><span class="p">,</span>
  <span class="s">&quot;The list of passengers for this trip [.txt].&quot;</span><span class="p">,</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="p">[](</span><span class="n">flecsi</span><span class="o">::</span><span class="n">any</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">option_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.txt&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">;</span>
  <span class="p">});</span>

<span class="cm">/*</span>
<span class="cm">  User-defined program options are available after FleCSI initialize has been</span>
<span class="cm">  invoked.</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">top_level_action</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">price</span><span class="p">{</span><span class="mf">0.0</span><span class="p">};</span>

  <span class="cm">/*</span>
<span class="cm">    Add cost for trim level. This option does not have to be checked with</span>
<span class="cm">    has_value() because it is defaulted. It is also unnecessary to check the</span>
<span class="cm">    value because it was declared with a validator function.</span>
<span class="cm">   */</span>

  <span class="n">price</span> <span class="o">+=</span> <span class="n">trim</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    Add cost for automatic transmission.</span>
<span class="cm">   */</span>

  <span class="n">price</span> <span class="o">+=</span> <span class="n">transmission</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;automatic&quot;</span> <span class="o">?</span> <span class="mf">200.0</span> <span class="o">:</span> <span class="mf">0.0</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    Add cost for child seat.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">child_seat</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">price</span> <span class="o">+=</span> <span class="mf">50.0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Deduction for business.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">purpose</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">business</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">price</span> <span class="o">*=</span> <span class="mf">0.8</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Add cost for lightspeed. Since this option does not have a default, we need</span>
<span class="cm">    to check whether or not the flag was passed.</span>
<span class="cm">   */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">lightspeed</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">price</span> <span class="o">+=</span> <span class="mf">1000000.0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Do something with the positional argument.</span>
<span class="cm">   */</span>

  <span class="k">auto</span> <span class="n">read_file</span> <span class="o">=</span> <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Read passengers...</span>
    <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kt">size_t</span> <span class="n">passengers</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">passenger_list</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>

  <span class="n">price</span> <span class="o">*=</span> <span class="n">passengers</span> <span class="o">*</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Price: $&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">price</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// top_level_action</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">auto</span> <span class="n">status</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">initialize</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">run</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">status</span> <span class="o">==</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">run</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">help</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">status</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// if</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">start</span><span class="p">(</span><span class="n">top_level_action</span><span class="p">);</span>

  <span class="n">flecsi</span><span class="o">::</span><span class="n">finalize</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// main</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="example-3-flog-flecsi-logging-utility">
<h2>Example 3: FLOG (FleCSI Logging Utility)<a class="headerlink" href="#example-3-flog-flecsi-logging-utility" title="Permalink to this headline">¶</a></h2>
<p>FLOG provides users with a mechanism to print logging information to
various stream buffers, similar to the C++ objects std::cout, std::cerr,
and std::clog.  Multiple streams can be used simultaneously, so that
information about the running state of a program can be captured and
displayed at the same time.  In this example, we show how FLOG can be
configured to stream output to a file buffer, and the std::clog stream
buffer.</p>
<p>Before attempting this example, you should make sure that you have
configured and built FleCSI with ENABLE_FLOG=ON. Additional options
that are useful are:</p>
<ul class="simple">
<li><p>FLOG_ENABLE_COLOR_OUTPUT=ON</p></li>
<li><p>FLOG_ENABLE_TAGS=ON</p></li>
<li><p>FLOG_STRIP_LEVEL=0</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>One of the challenges of using distributed-memory and tasking runtimes
is that output written to the console often gets clobbered because
multiple threads of execution are all writing to the same descriptor
concurrently. FLOG fixes this by collecting output from different
threads and serializing it. This is an important and useful feature of
FLOG.</p>
</div>
<div class="section" id="buffer-configuration">
<h3>Buffer Configuration<a class="headerlink" href="#buffer-configuration" title="Permalink to this headline">¶</a></h3>
<p>By default, FLOG does not produce any output (even when enabled). In
order to see or capture output, your application must add at least one
output stream. This should be done after flecsi::initialize has been
invoked, and before flecsi::start. Consider the main function for this
example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

  <span class="cm">/*</span>
<span class="cm">    If FLECSI_ENABLE_FLOG is enabled, FLOG will automatically be initialized</span>
<span class="cm">    when flecsi::initialize() is invoked.</span>
<span class="cm">   */</span>

  <span class="k">auto</span> <span class="n">status</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">initialize</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">run</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">status</span> <span class="o">==</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">run</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">help</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">status</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// if</span>

  <span class="cm">/*</span>
<span class="cm">    In order to see or capture any output from FLOG, the user must add at least</span>
<span class="cm">    one output stream. The function log::add_output_stream provides an</span>
<span class="cm">    interface for adding output streams to FLOG. The FleCSI runtime must have</span>
<span class="cm">    been initialized before this function can be invoked.</span>
<span class="cm">   */</span>

  <span class="cm">/*</span>
<span class="cm">    Add the standard log descriptor to FLOG&#39;s buffers.</span>
<span class="cm">   */</span>

  <span class="n">log</span><span class="o">::</span><span class="n">add_output_stream</span><span class="p">(</span><span class="s">&quot;clog&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">clog</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">    Add an output file to FLOG&#39;s buffers.</span>
<span class="cm">   */</span>

  <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">log_file</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">);</span>
  <span class="n">log</span><span class="o">::</span><span class="n">add_output_stream</span><span class="p">(</span><span class="s">&quot;log file&quot;</span><span class="p">,</span> <span class="n">log_file</span><span class="p">);</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">flecsi</span><span class="o">::</span><span class="n">start</span><span class="p">(</span><span class="n">top_level_action</span><span class="p">);</span>

  <span class="n">flecsi</span><span class="o">::</span><span class="n">finalize</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// main</span>
</pre></div>
</div>
<p>The first output stream added is <a class="reference external" href="https://en.cppreference.com/w/cpp/io/clog">std::clog</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    Add the standard log descriptor to FLOG&#39;s buffers.</span>
<span class="cm">   */</span>

  <span class="n">log</span><span class="o">::</span><span class="n">add_output_stream</span><span class="p">(</span><span class="s">&quot;clog&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">clog</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The arguments to add_output_stream are:</p>
<ul class="simple">
<li><p><em>label (“clog”)</em>: <br />
This is an arbitrary label that may be used in future versions to
enable or disable output. The label should be unique.</p></li>
<li><p><em>stream buffer (std::clog)</em>: <br />
A std::ostream object.</p></li>
<li><p><em>colorize (true)</em>: <br />
A boolean indicating whether or not output to this stream buffer
should be colorized. It is useful to turn off colorization for
non-interactive output. The default is <em>false</em>.</p></li>
</ul>
<p>To add an output stream to a file, we can do the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    Add an output file to FLOG&#39;s buffers.</span>
<span class="cm">   */</span>

  <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">log_file</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">);</span>
  <span class="n">log</span><span class="o">::</span><span class="n">add_output_stream</span><span class="p">(</span><span class="s">&quot;log file&quot;</span><span class="p">,</span> <span class="n">log_file</span><span class="p">);</span>
</pre></div>
</div>
<p>That’s it! For this example, FLOG is now configured to write output to
std::clog, and to <em>output.txt</em>. Next, we will see how to actually write
output to these stream buffers.</p>
</div>
<div class="section" id="writing-to-buffers">
<h3>Writing to Buffers<a class="headerlink" href="#writing-to-buffers" title="Permalink to this headline">¶</a></h3>
<p>Output with FLOG is similar to std::cout. Consider the FLOG <em>info</em>
object:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;The value is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>This works just like any of the C++ output objects. FLOG provides four
basic output objects: <em>trace</em>, <em>info</em>, <em>warn</em>, and <em>error</em>. These
provide different color decorations for easy identification in terminal
output, and can be controlled using <em>strip levels</em> (discussed in the next
section).</p>
<p>The following code from this example shows some trivial usage of each of
the basic output objects:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    This output will always be generated because it is not scoped within a tag</span>
<span class="cm">    guard.</span>
<span class="cm">   */</span>

  <span class="n">flog</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Trace level output&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Info level output&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">flog</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Warn level output&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">flog</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error level output&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-output-strip-levels">
<h3>Controlling Output - Strip Levels<a class="headerlink" href="#controlling-output-strip-levels" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If FleCSI is configured with ENABLE_FLOG=OFF, all FLOG calls are
compiled out, i.e., there is no runtime overhead.</p>
</div>
<p>The strip level is a preprocessor option <em>FLOG_STRIP_LEVEL</em> that can
be specified during FleCSI configuration. Valid strip levels are
<em>[0-4]</em>. The default strip level is <em>0</em> (most verbose). Depending on
the strip level, FLOG limits the type of messages that are output.</p>
<ul class="simple">
<li><p><em>trace</em> <br />
Output written to the trace object is enabled for strip levels less
than 1.</p></li>
<li><p><em>info</em> <br />
Output written to the info object is enabled for strip levels less
than 2.</p></li>
<li><p><em>warn</em> <br />
Output written to the warn object is enabled for strip levels less
than 3.</p></li>
<li><p><em>error</em> <br />
Output written to the error object is enabled for strip levels less
than 4.</p></li>
</ul>
</div>
<div class="section" id="controlling-output-tag-groups">
<h3>Controlling Output - Tag Groups<a class="headerlink" href="#controlling-output-tag-groups" title="Permalink to this headline">¶</a></h3>
<p>Tag groups provide a mechanism to control the runtime output generated
by FLOG. The main idea is here is that developers can use FLOG to output
information that is useful in developing or debugging a program, and
leave it in the code. Then, specific groups of messages can be enabled
or disabled to only output useful information for the current
development focus.</p>
<p>To create a new tag, we use the log::tag type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">  Create some tags to control output.</span>
<span class="cm"> */</span>

<span class="n">log</span><span class="o">::</span><span class="n">tag</span> <span class="n">tag1</span><span class="p">(</span><span class="s">&quot;tag1&quot;</span><span class="p">);</span>
<span class="n">log</span><span class="o">::</span><span class="n">tag</span> <span class="n">tag2</span><span class="p">(</span><span class="s">&quot;tag2&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Tags take a single std::string argument that is used in the help message
to identify available tags.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>FLOG tags must be declared at namespace scope.</p>
</div>
<p>Once you have declared a tag, it can be used to limit output to one or
more <em>scoped</em> regions. The following code defines a guarded section of
output that will only be generated if <em>tag1</em> or <em>all</em> is specified to
the <code class="docutils literal notranslate"><span class="pre">--flog-tags</span></code> option:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    This output will only be generated if &#39;tag1&#39; or &#39;all&#39; is specified</span>
<span class="cm">    to &#39;--flog-tags&#39;.</span>
<span class="cm">   */</span>

  <span class="p">{</span>
    <span class="n">log</span><span class="o">::</span><span class="n">guard</span> <span class="n">guard</span><span class="p">(</span><span class="n">tag1</span><span class="p">);</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Trace level output (in tag1 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Info level output (in tag1 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Warn level output (in tag1 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error level output (in tag1 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// scope</span>
</pre></div>
</div>
<p>Here is another code example that defines a guarded section for <em>tag2</em>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
<span class="cm">    This output will only be generated if &#39;tag2&#39; or &#39;all&#39; is specified</span>
<span class="cm">    to &#39;--flog-tags&#39;.</span>
<span class="cm">   */</span>

  <span class="p">{</span>
    <span class="n">log</span><span class="o">::</span><span class="n">guard</span> <span class="n">guard</span><span class="p">(</span><span class="n">tag2</span><span class="p">);</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Trace level output (in tag2 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Info level output (in tag2 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Warn level output (in tag2 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">flog</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error level output (in tag2 guard)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// scope</span>
</pre></div>
</div>
<p>You should experiment with invoking this example:</p>
<p>Invoking this example with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> flag will show the available
tags:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./flog --help
</pre></div>
</div>
<p>which should look something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Usage: flog</span>

<span class="go">Basic Options:</span>
<span class="go">  -h [ --help ]                   Print this message and exit.</span>

<span class="go">FleCSI Options:</span>
<span class="go">  --flog-tags arg (=all)          Enable the specified output tags, e.g.,</span>
<span class="go">                                  --flog-tags=tag1,tag2.</span>
<span class="go">  --flog-verbose [=arg(=1)] (=0)  Enable verbose output. Passing &#39;-1&#39; will</span>
<span class="go">                                  strip any additional decorations added by</span>
<span class="go">                                  flog and will only output the user&#39;s message.</span>
<span class="go">  --flog-process arg (=-1)        Restrict output to the specified process id.</span>

<span class="go">Available FLOG Tags (FleCSI Logging Utility):</span>
<span class="go">  tag2</span>
<span class="go">  tag1</span>
</pre></div>
</div>
<p>Invoking this example with <code class="docutils literal notranslate"><span class="pre">--flog-tags=tag1</span></code> will generate output for
unguarded sections, and for output guarded with the <em>tag1</em> tag:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./flog --flog-tags<span class="o">=</span>tag1
<span class="go">[trace all p0] Trace level output</span>
<span class="go">[info all p0] Info level output</span>
<span class="go">[Warn all p0] Warn level output</span>
<span class="go">[ERROR all p0] Error level output</span>
<span class="go">[trace tag1 p0] Trace level output (in tag1 guard)</span>
<span class="go">[info tag1 p0] Info level output (in tag1 guard)</span>
<span class="go">[Warn tag1 p0] Warn level output (in tag1 guard)</span>
<span class="go">[ERROR tag1 p0] Error level output (in tag1 guard)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="control.html" class="btn btn-neutral float-right" title="Control Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../tutorial.html" class="btn btn-neutral float-left" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 Los Alamos National Laboratory, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Contents caption */
    .wy-menu-vertical>p.caption {
      color: #ffffff;
    }

    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #e3e2db;
    }
    .wy-side-nav-search>div.version, .wy-nav-top>div.version {
      color: #5f5d5f;
    }

    /* Sidebar */
    .wy-nav-side {
      background: #216897;
      color: #ffffff;
    }
  </style>


</body>
</html>