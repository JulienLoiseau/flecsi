#-----------------------------------------------------------------------------#
# FleCSI CI Configuration for Fedora 31
#------------------------------------------------------------------------------#

FROM fedora:30

#------------------------------------------------------------------------------#
# Install basic linux requirements
#------------------------------------------------------------------------------#

RUN dnf update -y && dnf install -y \
  clang \
  cmake \
  curl \
  doxygen \
  emacs-color-theme \
  file \
  findutils \
  flex \
  gcc \
  gcc-c++ \
  gcc-gfortran \
  git \
  lbzip2 \
  make \
  ncurses-devel \
  passwd \
  patch \
  python3 \
  python3-pip \
  vim-enhanced \
  wget \
  which \
  xz

#------------------------------------------------------------------------------#
# Add flecsi user
#------------------------------------------------------------------------------#

RUN groupadd -r flecsi
RUN useradd -r -m -g flecsi flecsi
RUN echo "flecsi ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/flecsi

USER flecsi
WORKDIR /home/flecsi

RUN \
  echo "syntax on" > .vimrc && \
  echo "set background=dark" >> .vimrc && \
  echo "highlight Comment cterm=italic" >> .vimrc

#------------------------------------------------------------------------------#
# Capture version information
#------------------------------------------------------------------------------#

RUN dnf info --installed ncurses | grep Version | \
  awk '{ print $3 }' > .ncurses_version
RUN gcc -v 2>&1 | grep "gcc version" | awk '{ print $3 }' > .gnu_version

#------------------------------------------------------------------------------#
# Install pip packages
#------------------------------------------------------------------------------#

RUN pip3 install --user pyyaml
RUN pip3 install --user Sphinx
RUN pip3 install --user recommonmark
RUN pip3 install --user sphinx_rtd_theme

#------------------------------------------------------------------------------#
# Set default shell for interactive
#------------------------------------------------------------------------------#

CMD /bin/bash

# vim: syntax=dockerfile
