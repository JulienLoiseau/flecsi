#------------------------------------------------------------------------------#
# FleCSI CI Configuration for CentOS 8
#------------------------------------------------------------------------------#

FROM fedora:32

#------------------------------------------------------------------------------#
# Install basic linux requirements
#------------------------------------------------------------------------------#

RUN dnf update -y

RUN dnf install -y \
  clang \
  curl \
  doxygen \
  emacs-color-theme \
  file \
  flex \
  gcc \
  gcc-c++ \
  gcc-gfortran \
  git \
  graphviz \
  lbzip2 \
  make \
  passwd \
  patch \
  vim-enhanced \
  wget \
  which \
  xz

#------------------------------------------------------------------------------#
# Enable root for debugging
#------------------------------------------------------------------------------#

RUN echo 'flecsi' | passwd --stdin root

#------------------------------------------------------------------------------#
# Build gcc 9.3.0
#------------------------------------------------------------------------------#

RUN wget http://ftpmirror.gnu.org/gnu/gcc/gcc-9.3.0/gcc-9.3.0.tar.xz
RUN tar xf gcc-9.3.0.tar.xz

WORKDIR /gcc-9.3.0

RUN contrib/download_prerequisites
RUN ./configure --prefix=/opt/gcc/9.3.0 --disable-multilib \
  --enable-languages=c,c++,fortran
RUN make
RUN make install

ENV PATH /opt/gcc/9.3.0:$PATH

#------------------------------------------------------------------------------#
# Add flecsi user
#------------------------------------------------------------------------------#

RUN groupadd -r flecsi
RUN useradd -r -m -g flecsi flecsi

USER flecsi
WORKDIR /home/flecsi

RUN \
  echo "syntax on" > .vimrc && \
  echo "set background=dark" >> .vimrc && \
  echo "highlight Comment cterm=italic" >> .vimrc

#------------------------------------------------------------------------------#
# Set default shell for interactive
#------------------------------------------------------------------------------#

CMD /bin/bash

# vim: syntax=dockerfile
