#-----------------------------------------------------------------------------#
# FleCSI CI Configuration for ClearLinux
#------------------------------------------------------------------------------#

FROM clearlinux:latest

#------------------------------------------------------------------------------#
# Install basic linux requirements
#------------------------------------------------------------------------------#

RUN swupd bundle-add \
  c-basic \
  curl \
  doxygen \
  emacs \
  file \
  flex \
  git \
  graphviz \
  less \
  llvm \
  make \
  man-pages \
  os-core \
  os-core-search \
  patch \
  python3-basic \
  sysadmin-basic \
  vim \
  wget \
  which

#------------------------------------------------------------------------------#
# Enable root for debugging
#------------------------------------------------------------------------------#

RUN echo -e 'flecsi\nflecsi' | passwd root

#------------------------------------------------------------------------------#
# Add flecsi user
#------------------------------------------------------------------------------#

RUN groupadd -r flecsi
RUN useradd -r -m -g flecsi flecsi

USER flecsi
WORKDIR /home/flecsi

RUN \
  echo "syntax on" > .vimrc && \
  echo "set background=dark" >> .vimrc && \
  echo "highlight Comment cterm=italic" >> .vimrc

#------------------------------------------------------------------------------#
# Capture graphviz version
#------------------------------------------------------------------------------#

RUN dot -V 2>&1 | awk '{ print $5 }' > .graphviz_version

#------------------------------------------------------------------------------#
# Set default shell for interactive
#------------------------------------------------------------------------------#

CMD /bin/bash

# vim: syntax=dockerfile
